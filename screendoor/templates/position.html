{% extends 'base_logged_in.html' %}
{% load string_interpolation %}
{% load static %}
{% block content %}
<!-- Beginning of position display -->
{% if position is not None %}
<div class="container positions">
  <form action="" method="POST" class="sort-positions">
    {% csrf_token %}
    <input type="submit" class="btn-flat blue-text" value="←  {{ positionText.back_to_positions }}">
    <h6 class="btn-flat disabled"></h6>
  </form>
  <form method="post" id="save-position" enctype="multipart/form-data" action="">
    {% csrf_token %}
    <div class="row">
      <!--Beginning of position card -->
      <div class="col card white hoverable">
        <div class="card-content col s12">
          <div class="row valign-wrapper">
            <input type="hidden" name="edit-position" value="true">
            <input type="hidden" name="position-id" value="{{ position.id }}">
            <input type="hidden" class="hidden" name="position-title" value="{{ position.position_title }}">
            <h4 name="position-title" id="title" class="col s8 left left-align position-header grey-text text-darken-3">{{ position.position_title }}</h4>
            <div class="col s4 right">
            </div>
          </div>
          <!-- Upload Applications and Delete buttons -->
          <div class="row left">
            <div class="position-view-buttons">
              <a class="btn-flat blue-text modal-trigger" href="#upload-applications-modal">{{ userVisibleText.upload_applications }}</a>
              <a class="btn-flat blue-text modal-trigger" href="#delete-modal">{{ userVisibleText.delete }}</a>
              <input type="button" class="btn-flat" id="expand-all" value="{{ userVisibleText.expand_all }}">
              <input type="button" class="btn-flat" id="collapse-all" value="{{ userVisibleText.collapse_all }}">
            </div>
          </div>
          <!-- Position row 1 headers -->
          <table class="highlight editable">
            <thead class="collapse">
              <tr>
                <th colspan="1"><i class="collapse-arrows material-icons grey-text text-darken-2">keyboard_arrow_down</i></th>
                <th colspan="5">{{ positionText.classification }}</th>
                <th colspan="10">{{ positionText.reference_number }}</th>
                <th colspan="10">{{ positionText.selection_process_number }}</th>
              </tr>
            </thead>
            <!-- Position row 1 body -->
            <tbody>
              <tr>
                <th colspan="1"></th>
                <input type="hidden" class="hidden" name="position-classification" value="{{ position.classification }}">
                <td colspan="5" name="position-classification">{{ position.classification }}</td>
                <input type="hidden" class="hidden" name="position-reference" value="{{ position.reference_number }}">
                <td colspan="10" name="position-reference">{{ position.reference_number }}</td>
                <input type="hidden" class="hidden" name="position-selection" value="{{ position.selection_process_number }}">
                <td colspan="10" name="position-selection">{{ position.selection_process_number }}</td>
              </tr>
            </tbody>
            <!-- Position row 2 headers -->
            <thead class="collapse">
              <tr>
                <th colspan="1"><i class="collapse-arrows material-icons grey-text text-darken-2">keyboard_arrow_down</i></th>
                <th colspan="5">{{ positionText.date_closed }}</th>
                <th colspan="4">{{ positionText.number_of_positions }}</th>
                <th colspan="6">{{ positionText.salary_range }}</th>
                <th colspan="10">{{ positionText.open_to }}</th>
              </tr>
            </thead>
            <!-- Position row 2 body -->
            <tbody>
              <tr>
                <th colspan="1"></th>
                <input type="hidden" class="hidden" name="position-date-closed" value='{{ position.date_closed|date:"M d, Y" }}'>
                <td colspan="5" name="position-date-closed">{{ position.date_closed|date:"M d, Y" }}</td>
                <input type="hidden" class="hidden" name="position-num-positions" value='{{ position.num_positions }}'>
                <td colspan="4" name="position-num-positions">{{ position.num_positions }}</td>
                <input type="hidden" class="hidden" name="position-salary-range" value='${{ position.salary_min }} - ${{ position.salary_max }}'>
                <td colspan="6" name="position-salary-range">${{ position.salary_min }} - ${{ position.salary_max }}</td>
                <input type="hidden" class="hidden" name="position-open-to" value='{{ position.open_to }}'>
                <td colspan="10" name="position-open-to">{{ position.open_to }}</td>
              </tr>
            </tbody>
            <!-- Position row 3 header -->
            <thead class="collapse">
              <tr>
                <th colspan="1"><i class="collapse-arrows material-icons grey-text text-darken-2">keyboard_arrow_down</i></th>
                <th colspan="25">{{ positionText.position_information }}</th>
              </tr>
            </thead>
            <!-- Position row 3 body -->
            <tbody>
              <tr>
                <th colspan="1"></th>
                <input type="hidden" class="hidden" name="position-description" value='{{ position.description }}'>
                <td colspan="25" name="position-description">{{ position.description }}</td>
              </tr>
            </tbody>
            <!-- Position education and experience rows -->
            <h5>{{ userVisibleText.education_and_experience_criteria }}</h5>
            {% for req in position.requirement_set.all %}
            <!-- ifchanged executes only for distinct values without repetition -->
            {% ifchanged %}
            <thead class="collapse">
              <tr>
                <!-- Requirement type, e.g. education, experience, assets -->
                <th colspan="1"><i class="collapse-arrows material-icons grey-text text-darken-2">keyboard_arrow_down</i></th>
                <th colspan="25">{{ req.requirement_type }}</th>
              </tr>
            </thead>
            {% endifchanged %}
            <tbody>
              <tr>
                <!-- Requirement abbreviation, e.g. EX1, and description -->
                <th colspan="1"></th>
                <input type="hidden" class="hidden" name="position-requirement{{ forloop.counter }}" value='{{ req.abbreviation }}: {{ req.description|linebreaksbr }}'>
                <td colspan="25" name="position-requirement{{ forloop.counter }}">{{ req.abbreviation }}: {{ req.description|linebreaksbr }}</td>
              </tr>
            </tbody>
            {% endfor %}
          </table>
          <!-- Date and time position was added -->
          <div class="row position-bottom-buttons">
            <div class="col s6 left" id="import-position-buttons">
              <input type="button" id="edit-button" name="edit" class="position-edit-btn btn-flat blue-text modal-trigger" value="{{ userVisibleText.edit }}">
              <input type="button" id="save-button" name="save" class="btn-pad btn-flat blue-text modal-trigger hide" value="Save">
            </div>
            <h6 class="btn-flat right black-text">Position added: {{ position.created }}</h6>
          </div>
        </div>
      </div>
    </div>
  </form>
  <!-- Error message if position is invalid/cannot be displayed -->
  {% else %}
  <h5>{{ positionText.cannot_display_position }}</h5>
  <!-- End of position display -->
  {% endif %}
  <!-- Beginning of applicants display -->
  {% if applicants  %}
  <!-- Applications anchor -->
  <a id="applications"></a>
  <!-- Application sort by form -->
  <form action="" method="POST" enctype="multipart/form-data" class="sort-applications right">
    {% csrf_token %}
    <h6 class="btn-flat disabled sortby-button">{{ userVisibleText.sort_by }}</h6>
    <input type="submit" class="btn-flat" value="ID">
    <input type="submit" class="btn-flat blue-text" value="Score">
  </form>
  <!-- Application field headers -->
  <div class="col">
    <div class="col">
      <div class="col s12">
        <table class="applicant-table">
          <thead>
            <tr>
              <th colspan="10">Applicant ID</th>
              <th colspan="1">Score</th>
              <th colspan="1">PDF</th>
            </tr>
          </thead>
        </table>
      </div>
    </div>
  </div>
  {% for applicant in applicants %}
  <!-- Mock application 1 -->
  <div class="col card white hoverable">
    <div class="card-content col s12 application-preview">
      <!-- Position row 1 body -->
      <table class="highlight applicant-table">
        <form method="post" id="save-position" enctype="multipart/form-data" action="">
          {% csrf_token %}
          <input type="hidden" class="hidden" name="position-id" value='{{ position.id }}'>
          <input type="hidden" class="hidden" name="applicant-id" value='{{ applicant.id }}'>
          <tbody>
            <tr>
              <td colspan="10"><input type="submit" name="application" class="application-button modal-trigger blue-text sort-applications" value="{{ applicant.applicant_id }}"></td>
              <td colspan="1"><i class="material-icons green-text">looks_{{ forloop.counter }}</i></td>
              <td colspan="1"><i class="material-icons red-text">picture_as_pdf</i></td>
            </tr>
          </tbody>
        </form>
      </table>
    </div>
  </div>
  {% endfor %}
  {% endif %}
  <!-- End of applicants display -->
</div>
<!-- Modal delete position confirmation pop-up -->
<div id="delete-modal" class="modal">
  <div class="modal-content">
    <h5>{{ userVisibleText.confirm_delete_header }}</h5>
    <p>{{ userVisibleText.confirm_delete }}</p>
    <h6>{{ position.position_title }}</h6>
  </div>
  <form action="" method="POST">
    {% csrf_token %}
    <div class="modal-footer">
      <input type="hidden" id="delete-confirm-id" name="position-id" value="{{ position.id }}">
      <input type="submit" id="delete-confirm-button" class="btn-flat blue-text position-button" name="delete" value="{{ userVisibleText.delete }}">
      <a href="#!" class="modal-close btn-flat blue-text position-button">Cancel</a>
    </div>
  </form>
</div>

<!-- Modal upload applications pop-up -->
<div id="upload-applications-modal" class="modal">
  <form action="" method="POST">
    {% csrf_token %}
    <div class="modal-content">
      <h5>{{ applicationsForm.title }}</h5>
      <p id="upload-applications-text">{{ applicationsForm.description|interpolate:position.position_title }}</p>
      <!-- PDF/File input -->
      <div class="file-field input-field">
        <div class="btn-small">
          <span>{{ applicationsForm.browse }}</span>
          <input type="hidden" name="position-id" value="{{ position.id }}">
          <!-- Input accepts multiple PDF file -->
          <input type="file" name="pdf" id="pdf" class="btn-small" value="{{ applicationsForm.browse }}" required multiple>
        </div>
        <div class="file-path-wrapper">
          <input id="pdf_path_input" class="file-path validate" type="text"
                 placeholder="{{ applicationsForm.choose_files }}" />
        </div>
      </div>
    </div>
    <!-- Upload and cancel buttons -->
    <div class="modal-footer">
      <input type="hidden" id="upload-applications-id" name="position-id" value="{{ position.id }}">
      <input type="submit" id="upload-applications-button" class="btn-flat blue-text position-button" name="upload-applications" value="{{ applicationsForm.upload }}">
      <a href="#!" class="modal-close btn-flat blue-text position-button">{{ userVisibleText.cancel }}</a>
    </div>
  </form>
</div>

<!-- MaterializeCSS JS library  -->
<script src="{% static 'js/materialize.js' %}"></script>
<!-- Script for position delete confirmation -->
<script src="{% static 'js/position-delete.js' %}"></script>
<!-- Script for expanding and collapsing table rows -->
<script src="{% static 'js/tables.js' %}"></script>
<!-- Script for editing table values -->
<script src="{% static 'js/position-detail-edit.js' %}"></script>
{% endblock %}
