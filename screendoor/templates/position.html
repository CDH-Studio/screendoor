{% extends 'base_logged_in.html' %}
{% load string_interpolation %}
{% load static %}
{% block content %}
<!-- Beginning of position display -->
{% if position is not None %}
<div class="container positions">
  <form action="" method="POST" class="sort-positions">
    {% csrf_token %}
    <input type="submit" class="btn-flat blue-text" value="←  {{ positionText.back_to_positions }}">
    <h6 class="btn-flat disabled"></h6>
  </form>
  <div class="row">
    <!--Beginning of confirm position card -->
    <div class="col card white hoverable">
      <div class="card-content col s12">
        <div class="row valign-wrapper">
          <h4 class="col s12 left position-header grey-text text-darken-3">{{ position.position_title }}</h4>
        </div>
        <!-- Upload Applications and Delete buttons -->
        <div class="row left">
          <div class="position-view-buttons">
            <a class="btn-flat blue-text modal-trigger" href="#upload-applications-modal">{{ userVisibleText.upload_applications }}</a>
            <a class="btn-flat blue-text modal-trigger" href="#delete-modal">{{ userVisibleText.delete }}</a>
            <button class="btn-flat" id="expand-all">{{ userVisibleText.expand_all }}</button>
            <button class="btn-flat" id="collapse-all">{{ userVisibleText.collapse_all }}</button>
          </div>
        </div>
        <!-- Position row 1 headers -->
        <table class="highlight">
          <thead class="collapse">
            <tr>
              <th colspan="1"><i class="collapse-arrows material-icons grey-text text-darken-2">keyboard_arrow_down</i></th>
              <th colspan="5">{{ positionText.classification }}</th>
              <th colspan="10">{{ positionText.reference_number }}</th>
              <th colspan="10">{{ positionText.selection_process_number }}</th>
            </tr>
          </thead>
          <!-- Position row 1 body -->
          <tbody>
            <tr>
              <td colspan="1"></td>
              <td colspan="5">{{ position.classification }}</td>
              <td colspan="10">{{ position.reference_number }}</td>
              <td colspan="10">{{ position.selection_process_number }}</td>
            </tr>
          </tbody>
          <!-- Position row 2 headers -->
          <thead class="collapse">
            <tr>
              <th colspan="1"><i class="collapse-arrows material-icons grey-text text-darken-2">keyboard_arrow_down</i></th>
              <th colspan="5">{{ positionText.date_closed }}</th>
              <th colspan="4">{{ positionText.number_of_positions }}</th>
              <th colspan="6">{{ positionText.salary_range }}</th>
              <th colspan="10">{{ positionText.open_to }}</th>
            </tr>
          </thead>
          <!-- Position row 2 body -->
          <tbody>
            <tr>
              <td colspan="1"></td>
              <td colspan="5">{{ position.date_closed|date:"M d, Y" }}</td>
              <td colspan="4">{{ position.num_positions }}</td>
              <td colspan="6">${{ position.salary_min }} - ${{ position.salary_max }}</td>
              <td colspan="10">{{ position.open_to }}</td>
            </tr>
          </tbody>
          <!-- Position row 3 header -->
          <thead class="collapse">
            <tr>
              <th colspan="1"><i class="collapse-arrows material-icons grey-text text-darken-2">keyboard_arrow_down</i></th>
              <th colspan="25">{{ positionText.position_information }}</th>
            </tr>
          </thead>
          <!-- Position row 3 body -->
          <tbody>
            <tr>
              <td colspan="1"></td>
              <td colspan="25">{{ position.description }}</td>
            </tr>
          </tbody>
          <!-- Position education and experience rows -->
          <h5>{{ userVisibleText.education_and_experience_criteria }}</h5>
          {% for req in position.requirement_set.all %}
          <!-- ifchanged executes only for distinct values without repetition -->
          {% ifchanged %}
          <thead class="collapse">
            <tr>
              <!-- Requirement type, e.g. education, experience, assets -->
              <th colspan="1"><i class="collapse-arrows material-icons grey-text text-darken-2">keyboard_arrow_down</i></th>
              <th colspan="25">{{ req.requirement_type }}</th>
            </tr>
          </thead>
          {% endifchanged %}
          <tbody>
            <tr>
              <!-- Requirement abbreviation, e.g. EX1, and description -->
              <td colspan="1"></td>
              <td colspan="25">{{ req.abbreviation }}: {{ req.description|linebreaksbr }}</td>
            </tr>
          </tbody>
          {% endfor %}
        </table>
        <!-- Date and time position was added -->
        <div class="row position-buttons right">
          <h6 class="btn-flat black-text">Position added: {{ position.created }}</h6>
        </div>
      </div>
    </div>
  </div>
</div>
<br>
<!-- Error message if position is invalid/cannot be displayed -->
{% else %}
<h5>{{ positionText.cannot_display_position }}</h5>
<!-- End of position display -->
{% endif %}
<!-- Modal delete position confirmation pop-up -->
<div id="delete-modal" class="modal">
  <div class="modal-content">
    <h5>{{ userVisibleText.confirm_delete_header }}</h5>
    <p>{{ userVisibleText.confirm_delete }}</p>
    <h6>{{ position.position_title }}</h6>
  </div>
  <form action="" method="POST">
    {% csrf_token %}
    <div class="modal-footer">
      <input type="hidden" id="delete-confirm-id" name="id" value="{{ position.id }}">
      <input type="submit" id="delete-confirm-button" class="btn-flat blue-text position-button" name="delete" value="{{ userVisibleText.delete }}">
      <a href="#!" class="modal-close btn-flat blue-text position-button">Cancel</a>
    </div>
  </form>
</div>

<!-- Modal upload applications pop-up -->
<div id="upload-applications-modal" class="modal">
  <form action="" method="POST">
    {% csrf_token %}
    <div class="modal-content">
      <h5>{{ applicationsForm.title }}</h5>
      <p id="upload-applications-text">{{ applicationsForm.description|interpolate:position.position_title }}</p>
      <!-- PDF/File input -->
      <div class="file-field input-field">
        <div class="btn-small">
          <span>{{ applicationsForm.browse }}</span>
          <input type="hidden" name="id" value="{{ position.id }}">
          <!-- Input accepts multiple PDF file -->
          <input type="file" name="pdf" id="pdf_input" class="btn-small" value="{{ applicationsForm.browse }}" required multiple>
        </div>
        <div class="file-path-wrapper">
          <input id="pdf_path_input" class="file-path validate" type="text"
                 placeholder="{{ applicationsForm.choose_files }}" />
        </div>
      </div>
    </div>
    <!-- Upload and cancel buttons -->
    <div class="modal-footer">
      <input type="hidden" id="upload-applications-id" name="id" value="{{ position.id }}">
      <input type="submit" id="upload-applications-button" class="btn-flat blue-text position-button" name="upload-applications" value="{{ applicationsForm.upload }}">
      <a href="#!" class="modal-close btn-flat blue-text position-button">{{ userVisibleText.cancel }}</a>
    </div>
  </form>
</div>

<!-- MaterializeCSS JS library  -->
<script src="{% static 'js/materialize.js' %}"></script>
<script src="{% static 'js/position-delete.js' %}"></script>
<!-- Script for expanding and collapsing table rows -->
<script src="{% static 'js/tables.js' %}"></script>
{% endblock %}
