{% extends 'base_logged_in.html' %}
{% load string_interpolation %}
{% load static %}
{% block content %}

<!-- PLACEHOLDER -->
<div class="container positions">
  <a href="{% url 'position' applicant.parent_position.reference_number applicant.parent_position.id %}" class="btn-flat blue-text sort-positions">
    ‚Üê  {{ applicantText.back_to_position }}: {{ applicant.parent_position.position_title }}
  </a>
  <input type="hidden" class="hidden" name="position-id" value='{{ position.id }}'>
  <h6 class="btn-flat disabled"></h6>
  <div class="row">
    <!--Beginning of application card -->
    <div class="col s12 card white">
      <div class="card-content col s12 applicant-card">
        <!-- Application row 1 headers -->
        <!-- Upload Applications and Delete buttons -->
        <div class="row applicant-top-row">
          <div class="applicant-collapse-buttons valign-wrapper">
            <input type="button" class="btn-flat right" id="expand-all" value="{{ applicantText.expand_all }}">
            <input type="button" class="btn-flat right" id="collapse-all" value="{{ applicantText.collapse_all }}">
          </div>
          <h6 class="valign-wrapper">
            <i class="applicant-detail-star applicant-icon material-icons small grey-text">star_border</i>
            {% comment %}
            {{ applicantText.applicant_information }}
            {% endcomment %}
            {{ applicant.applicant_id }}
            <span class="{% if applicant.percentage_correct <= 33 %}
                         applicant-summary-card list card-panel red
                         {% elif applicant.percentage_correct > 33 and applicant.percentage_correct <= 66 %}
                         applicant-summary-card list card-panel orange
                         {% elif applicant.percentage_correct > 66 and applicant.percentage_correct <= 100 %}
                         applicant-summary-card list card-panel green
                         {% endif %}
                         white-text applicant-question-total-detail">{{ applicant.number_yes_responses }}/{{ applicant.number_questions }} ({{ applicant.percentage_correct }}%)</span>
          </h6>
        </div>
        <div class="collapse-table">
          <!-- Applicant Totals -->
          <div class="row collapse">
            <div class="col cell-header">
              <i class="collapse-arrows material-icons grey-text text-darken-2">keyboard_arrow_down</i>
            </div>
            <div class="col s4 cell-header">
              {{ applicantText.applicant_id }}
            </div>
            <div class="col s4 cell-header">
              {{ applicantText.citizenship }}
            </div>
            <div class="col s3 cell-header">
              {{ applicantText.classifications }}
            </div>
          </div>
          <!-- Application row 1 body -->
          <div class="row body-row">
            <div class="col cell-body"></div>
            <div class="col s4 cell-body">
              {{ applicant.applicant_id }}
            </div>
            <div class="col s4 cell-body">
              {{ applicant.citizenship }}
            </div>
            <div class="col s3 cell-body">
              {% for classification in classifications %}{{ applicantText.substantive }}: {{ classification.classification_substantive }}<br>{{ applicantText.current }}: {{ classification.classification_current }}{% endfor %}
            </div>
          </div>
          <!-- Application row 2 head -->
          <div class="row collapse">
            <div class="col cell-header">
              <i class="collapse-arrows material-icons grey-text text-darken-2">keyboard_arrow_down</i>
            </div>
            <div class="col s4 cell-header">
              {{ applicantText.priority }}
            </div>
            <div class="col s4 cell-header">
              {{ applicantText.veteran_preference }}
            </div>
            <div class="col s3 cell-header">
              {{ applicantText.streams }}
            </div>
          </div>
          <!-- Application row 2 body -->
          <div class="row body-row">
            <div class="col cell-body"></div>
            <div class="col s4 cell-body">
              {{ applicant.priority }}
            </div>
            <div class="col s4 cell-body">
              {{ applicant.veteran_preference }}
            </div>
            <div class="col s3 cell-body">
              {% for stream in streams reversed %}{{ stream.stream_name }}{% if forloop.counter < streams|length %} | {% endif %}{% endfor %}
            </div>
          </div>
          <!-- Application row 3 headers -->
          <div class="row collapse">
            <div class="col cell-header">
              <i class="collapse-arrows material-icons grey-text text-darken-2">keyboard_arrow_down</i>
            </div>
            <div class="col s4 cell-header">
              {{ applicantText.french_working_ability }}
            </div>
            <div class="col s4 cell-header">
              {{ applicantText.english_working_ability }}
            </div>
            <div class="col s3 cell-header">
              {{ applicantText.first_official_language }}
            </div>
          </div>
          <!-- Application row 3 body -->
          <div class="row body-row">
            <div class="col cell-body"></div>
            <div class="col s4 cell-body">
              {{ applicant.french_working_ability }}
            </div>
            <div class="col s4 cell-body">
              {{ applicant.english_working_ability }}
            </div>
            <div class="col s3 cell-body">
              {{ applicant.first_official_language }}
            </div>
          </div>
          <!-- Application row 4 headers -->
          <div class="row collapse">
            <div class="col cell-header">
              <i class="collapse-arrows material-icons grey-text text-darken-2">keyboard_arrow_down</i>
            </div>
            <div class="col s4 cell-header">
              {{ applicantText.written_exam_language }}
            </div>
            <div class="col s4 cell-header">
              {{ applicantText.correspondence_language }}
            </div>
            <div class="col s3 cell-header">
              {{ applicantText.interview_language }}
            </div>
          </div>
          <!-- Application row 4 body -->
          <div class="row body-row">
            <div class="col cell-body"></div>
            <div class="col s4 cell-body">
              {{ applicant.written_exam }}
            </div>
            <div class="col s4 cell-body">
              {{ applicant.correspondence }}
            </div>
            <div class="col s3 cell-body">
              {{ applicant.interview }}
            </div>
          </div>

          <!-- Beginning of Education Section -->
          {% if educations is not None %}
          <div class="row header-row">
            <div class="col s11">
              <h6>
                {{ applicantText.education }} <i class="expand-collapse-education material-icons grey-text text-darken-2">unfold_more</i>
              </h6>
            </div>
          </div>

          <!-- Education Headers -->
          <ul class="education-list">
            {% for education in educations %}
            <li class="education-item hoverable">
              <div class="row">
                <div class="row education-header">
                  <div class="col cell-header">
                    <i class="education-icon collapse-arrows material-icons grey-text text-lighten-5 text-darken-{{ forloop.counter }} small">school</i>
                  </div>
                  <!-- Displays academic level full width if no institution and area of study (i.e., for secondary school) -->
                  <div id="education-academic-truncated{{ forloop.counter0 }}"
                       class="cell-header truncation col {% if education.institution is None and education.area_of_study is None %}
                           s10
                           {% else %}
                           s4
                           {% endif %}">{{ education.academic_level }}
                  </div>
                  {% if education.institution is not None %}
                  <div id="education-institution-truncated{{ forloop.counter0 }}" class="col s4 cell-header truncation">
                    {{ education.institution }}
                  </div>
                  {% endif %}
                  {% if education.area_of_study is not None %}
                  <div id="education-areastudy-truncated{{ forloop.counter0 }}" class="col s3 cell-header truncation">
                    {{ education.area_of_study }}
                  </div>
                  {% endif %}
                </div>
              </div>
              <div class="hidden-education-info row body-row row-closed">
                <div class="specialization col s4 cell-body table-subhead">
                  {{ applicantText.specialization }}: {{ education.specialization }}

                </div>
                <div class="program-length col s2 cell-body table-subhead">
                  {{ applicantText.program_length }}: {{ education.num_years_completed }}
                </div>
                <div class="years-completed col s2 cell-body table-subhead">
                  {{ applicantText.years_completed }}: {{ education.program_length }}
                </div>
                <div class="graduation-date col s3 cell-body table-subhead">
                  {{ applicantText.graduation_date }}: {{ education.graduation_date }}
                </div>
              </div>
            </li>
            {% endfor %}
          </ul>
          <!-- END OF EDUCATION DATA -->
          {% endif %}
          <div class="row">
            <div class="col s11 cell-header">
              <h6>
                <br>
                {{ applicantText.questions }} <i class="expand-collapse-question material-icons grey-text text-darken-2">unfold_more</i>
              </h6>
            </div>
          </div>
        </div>

        <!-- QUESTION HEADERS -->
        <ul class="question-list">
          {% for answer in answers %}
          <li class="question-preview">
            <!-- QUESTION PREVIEW -->
            <div class="question-preview-div hoverable row collapse question-row {% if answer.applicant_answer is True %}yes-answer {% else %}no-answer{% endif %}">
              <div class="row header-row question-row">
                <div class="col cell-header question-icon-div">
                  <i class="question-icons material-icons {% if answer.applicant_answer is True %}{% if forloop.counter|divisibleby:'2' %}green-text {% else %} green-text text-darken-1 {% endif %}{% else %}{% if forloop.counter|divisibleby:'2' %} red-text {% else %} red-text text-darken-1 {% endif %}{% endif %}">question_answer</i>
                </div>
                {% if answer.parent_question.parent_requirement is not None %}
                <div class="col requirement-abbreviation applicant-summary-card-small list card-panel blue">
                  {{ answer.parent_question.parent_requirement.abbreviation }}
                </div>
                <data class="question-data-text" value=": {{ answer.short_question_text }} "></data>
                <data class="requirement-text" value=": {{ answer.parent_question.parent_requirement.description }} "></data>
                {% endif %}
                <div class="col {% if answer.qualifier_set.all is not None %}
                            s9 {% elif answer.parent_question.parent_requirement is not None %} s10 {% else %} s11 {% endif %} cell-header question-row short-question-text truncation">{{ answer.parent_question.short_question_text }}
                </div>
                <div class="col right">
                  {% for qualifier in answer.qualifier_set.all %}
                  <div class="tooltip">
                    <i class="material-icons {% if qualifier.status == 'FAIL' %}red-text{% elif qualifier.status == 'PASS' %}green-text{% else %}grey-text{% endif %}">{% if qualifier.status == 'FAIL' %}close{% elif qualifier.status == 'PASS' %}check_circle{% else %}help_outline{% endif %}</i>
                    <span class="tooltiptext">{% if qualifier.status == 'FAIL' %}Failed{% elif qualifier.status == 'PASS' %}Passed{% else %}Indeterminate{% endif %}: {{ qualifier.qualifier_text }}</span></div>
                  {% endfor %}
                </div>
                <div class="extract-previews col s11">
                  {% if answer.extract_set is not None %}
                  {% for extract in answer.extract_set|dictsort:"extract_sentence_index" %}
                  {% if extract.extract_type == 'WHEN' %}
                  <i class="material-icons red-text text-lighten-1">date_range</i>
                  {% elif extract.extract_type == 'HOW' %}
                  <i class=" material-icons brown-text text-lighten-1">work</i>
                  {% endif %}
                  <span class="extract-preview grey-text text-darken-1">
                    {{ extract.extract_text|capfirst|linebreaksbr }}
                    <br>
                    {% if extract.next_extract_index != extract.extract_sentence_index and not forloop.last %}
                    {% endif %}
                  </span>
                  {% endfor %}
                  {% else %}
                  <i class="material-icons extract-icon red-text text-darken-1">clear</i>
                  <span class="extract-preview grey-text text-darken-1">
                    {{ applicantText.no_analysis }}
                  </span>
                  {% endif %}
                </div>
              </div>
            </div>
            <div class="question-answer-full row-closed row {% if answer.applicant_answer is True %}yes-answer-light {% else %}no-answer-light{% endif %}">
              <div class="row question-row question-buttons notes-row">
                <div class="col add-note tooltip">
                  <i class="question-icons material-icons orange-text">note_add</i>
                  <span class="tooltiptext">Add a note on this answer</span>
                </div>
                <div class="col s10 notes-area">
                  <form method="post" action="{% url 'add-note' %}" class="note-form" name="note-form" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="hidden" name="parent-answer" value="{{ answer.id }}">

                    <div class="note-box">
                      <textarea class="note-input" name="note-input" placeholder="Enter your note here" required></textarea>
                      <span class="save-cancel-note">
                        <i class="material-icons green-text save-note">add_box</i>
                        <i class="material-icons red-text cancel-note">cancel</i>
                      </span>
                    </div>
                  </form>
                  <div class="notes">
                    {% for note in answer.note_set %}
                    <div class="note">
                      <form method="post" action="{% url 'delete-note' %}" class="delete-note-form" name="delete-note-form" enctype="multipart/form-data">
                        {% csrf_token %}
                        <input type="hidden" name="parent-answer" value="{{ answer.id }}">
                        <input type="hidden" name="note-id" value="{{ note.id }}">
                        <input type="hidden" class="note-delete-answer-counter" value="{{ forloop.parentloop.counter0 }}">{{ forloop.counter }}.
                        <span class="note-text">{{ note.note_text }}</span>
                        <br>
                        <span class="note-author grey-text">{{ note.author }}, </span><span class="note-created grey-text">{{ note.created }}</span>
                        <i class="material-icons red-text delete-note">delete_forever</i>
                      </form>
                    </div>
                    {% endfor %}
                  </div>
                </div>
              </div>
              <div class="row question-row question-response-extracts">
                <div class="col s7 applicant-response-full"><p class="complementary-response-header">{{ applicantText.complementary_response }}</p><span class="answer-complementary-response">{{ answer.applicant_complementary_response }}</span></div>
                <div class="col s4 extracts-full">
                  <p class="extract-full-header">{{ applicantText.extracts }}</p>
                  <data class="answer-complementary-response-value" value="{{ answer.applicant_complementary_response }}" />
                  <data class="answer-id" value="{{ answer.id }}" />
                  {% if answer.extract_set is not None %}
                  {% for extract in answer.extract_set|dictsort:"extract_sentence_index" %}

                  <!-- Data classes for sentence highlighting -->
                  <data class="extract-string-index" value="{{ extract.extract_sentence_index }}"></data>
                  <data class="extract-ending-index" value="{{ extract.extract_ending_index }}"></data>
                  <data class="extract-next-index" value="{{ extract.next_extract_index }}"></data>
                  <data class="extract-string" value="{{ extract.extract_text }}"></data>
                  <data class="extract-id" value="{{ extract.id }}"></data>
                  <data class="extract-parent-answer-id" value="{{ extract.parent_answer.id }}"></data>
                  <data class="extract-parent-answer" value="{{ extract.parent_answer.applicant_complementary_response }}"></data>
                  <!-- Extracts full -->
                  {% if extract.extract_type == 'WHEN' %}
                  <i class="material-icons red-text text-lighten-1">date_range</i>
                  {% elif extract.extract_type == 'HOW' %}
                  <i class="material-icons brown-text text-lighten-1">work</i>
                  {% endif %}
                  <span class="extract-preview grey-text text-darken-1">
                    <span class="extract-text">{{ extract.extract_text|capfirst|linebreaksbr }}</span>
                    <br>
                  </span>
                  {% endfor %}
                  {% else %}
                  <i class="material-icons extract-icon red-text text-darken-1">clear</i>
                  <span class="grey-text text-darken-1">
                    {{ applicantText.no_analysis }}
                  </span>
                  {% endif %}
                </div>
              </div>
            </div>
          </li>

          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Misc. helper functions -->
<script src="{% static 'js/helper-functions.js' %}"></script>
<!-- Script for expanding and collapsing table rows -->
<script src="{% static 'js/tables.js' %}"></script>
<!-- Script for local storage -->
<script src="{% static 'js/localstorage.js' %}"></script>
<!-- Script for extract origin highlighting -->
<script src="{% static 'js/sentence-highlighting.js' %}"></script>
<!-- Script for initializing modal pop-ups -->
<script src="{% static 'js/sd-modal.js' %}"></script>
<script src="{% static 'js/applicant-questions.js' %}"></script>
<!-- Script for adding notes to positions -->
<script src="{% static 'js/notes.js' %}"></script>
{% endblock %}
