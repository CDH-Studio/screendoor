{% extends 'base_logged_in.html' %}
{% load string_interpolation %}
{% load static %}
{% block content %}

<!-- PLACEHOLDER -->
<div class="container positions">
  <a href="{% url 'position' applicant.parent_position.reference_number applicant.parent_position.id %}" class="btn-flat blue-text sort-positions">
    ‚Üê  {{ applicantText.back_to_position }}: {{ applicant.parent_position.position_title }}
  </a>
  <input type="hidden" class="hidden" name="position-id" value='{{ position.id }}'>
  <h6 class="btn-flat disabled"></h6>
  <div class="row">
    <!--Beginning of application card -->
    <div class="col s12 card white">
      <div class="card-content col s12 applicant-card">
        <!-- Application row 1 headers -->
        <!-- Upload Applications and Delete buttons -->
        <div class="row applicant-top-row">
          <h6 class="valign-wrapper">
            <span class="favourite_icon" id="{{ applicant.applicant_id }}" data-favourite-status="{{ favorite }}"><i class="applicant-detail-star applicant-icon material-icons small grey-text">star_border</i></span>
            {% comment %}
            {{ applicantText.applicant_information }}
            {% endcomment %}
            {{ applicant.applicant_id }}
            <span class="{% if applicant.percentage_correct <= 33 %}
                         applicant-summary-card list card-panel red
                         {% elif applicant.percentage_correct > 33 and applicant.percentage_correct <= 66 %}
                         applicant-summary-card list card-panel orange
                         {% elif applicant.percentage_correct > 66 and applicant.percentage_correct <= 100 %}
                         applicant-summary-card list card-panel green
                         {% endif %}
                         white-text applicant-question-total-detail">{{ applicant.number_yes_responses }}/{{ applicant.number_questions }} ({{ applicant.percentage_correct }}%)</span>
          </h6>
        </div>
        <div class="row applicant-header hoverable header-row">
          <div class="col applicant-icon">
            <i class="collapse-arrows material-icons grey-text text-lighten-1 small">person</i>
          </div>
          <div class="truncation col s3 applicant-citizenship">
            <span class="">{{ applicant.citizenship }}</span>
          </div>
          <div class="col s5 truncation">
            <span class="applicant-classification">
              <data id="substantive-classification-text" value=" {{ applicantText.substantive }} Classification"></data>
              <data id="current-classification-text" value=" {{ applicantText.current }} Classification"></data>
              {% for classification in classifications %}
              {% if classification.classification_substantive is not None %}
              <span class="classification-substantive card-panel applicant-summary-card list screendoor-color white-text">
                {{ classification.classification_substantive }}
              </span>
              {% endif %}
              {% if classification.classification_current is not None %}
              <span class="classification-current applicant-summary-card list card-panel screendoor-color lighten-2 white-text">
                {{ classification.classification_current }}
              </span>
              {% endif %}
              {% endfor %}
            </span>
          </div>
          <div class="col s3 truncation">
            <span class="applicant-streams">
              {% for stream in streams reversed %}
              {% if stream is not None %}
              <span class="applicant-summary-card-small list card-panel blue lighten-{{ forloop.revcounter }} darken-{{ forloop.counter }} white-text">Stream {{ forloop.counter }}</span>
              {% endif %}
              {% endfor %}
            </span>
          </div>
        </div>

        <div class="hidden-applicant-info row row-closed">
          <div class="hidden-applicant-row row body-row">
            <div class="specialization col s3 cell-body">
              {{ applicantText.priority }}: <br>{{ applicant.priority }}
            </div>
            <div class="program-length col s3 cell-body">
              {{ applicantText.veteran_preference }}: <br>{{ applicant.veteran_preference }}
            </div>
            <div class="years-completed col s3 cell-body">
              {{ applicantText.french_working_ability }}: <br>{{ applicant.french_working_ability }}
            </div>
            <div class="graduation-date col s2 cell-body">
              {{ applicantText.english_working_ability }}: <br>{{ applicant.english_working_ability }}
            </div>
          </div>

          <div class="hidden-applicant-row row body-row">
            <div class="specialization col s3 cell-body">
              {{ applicantText.first_official_language }}: <br>{{ applicant.first_official_language }}
            </div>
            <div class="program-length col s3 cell-body">
              {{ applicantText.written_exam_language }}: <br>{{ applicant.written_exam }}
            </div>
            <div class="years-completed col s3 cell-body">
              {{ applicantText.correspondence_language }}: <br>{{ applicant.correspondence }}
            </div>
            <div class="graduation-date col s2 cell-body">
              {{ applicantText.interview_language }}: <br>{{ applicant.interview }}
            </div>
          </div>
        </div>
        <!-- Beginning of Education Section -->
        {% if educations is not None %}
        <div class="row header-row">
          <div class="col s11">
            <h6>
              {{ applicantText.education }} <i class="expand-collapse-education material-icons grey-text text-darken-2">unfold_more</i>
            </h6>
          </div>
        </div>

        <!-- Education Headers -->
        <ul class="education-list">
          {% for education in educations %}
          <li class="education-item hoverable">
            <div class="row">
              <div class="row education-header">
                <div class="col cell-header">
                  <i class="education-icon collapse-arrows material-icons grey-text text-lighten-5 text-darken-{{ forloop.counter }} small">school</i>
                </div>
                <!-- Displays academic level full width if no institution and area of study (i.e., for secondary school) -->
                <div id="education-academic-truncated{{ forloop.counter0 }}"
                     class="cell-header truncation col {% if education.institution is None and education.area_of_study is None %}
                         s10
                         {% else %}
                         s4
                         {% endif %}">{{ education.academic_level }}
                </div>
                {% if education.institution is not None %}
                <div id="education-institution-truncated{{ forloop.counter0 }}" class="col s4 cell-header truncation">
                  {{ education.institution }}
                </div>
                {% endif %}
                {% if education.area_of_study is not None %}
                <div id="education-areastudy-truncated{{ forloop.counter0 }}" class="col s3 cell-header truncation">
                  {{ education.area_of_study }}
                </div>
                {% endif %}
              </div>
            </div>
            <div class="hidden-education-info row body-row row-closed">
              <div class="specialization col s4 cell-body table-subhead">
                {{ applicantText.specialization }}: <br>{% if education.specialization is not None %}{{ education.specialization }} years{% else %}N/A{% endif %}{{ education.specialization }}

              </div>
              <div class="program-length col s2 cell-body table-subhead">
                {{ applicantText.program_length }}: <br>{% if education.program_length is not None %}{{ education.program_length }} years{% else %}N/A{% endif %}
              </div>
              <div class="years-completed col s2 cell-body table-subhead">
                {{ applicantText.years_completed }}: <br>{% if education.num_years_completed is not None %}{{ education.num_years_completed }}{% else %}N/A{% endif %}
              </div>
              <div class="graduation-date col s3 cell-body table-subhead">
                {{ applicantText.graduation_date }}: <br>{% if education.graduation_date is not None %}{{ education.graduation_date }}{% else %}N/A{% endif %}
              </div>
            </div>
          </li>
          {% endfor %}
        </ul>
        <!-- END OF EDUCATION DATA -->
        {% endif %}
        <div class="row">
          <div class="col s11 cell-header">
            <h6>
              <br>
              {{ applicantText.questions }} <i class="expand-collapse-question material-icons grey-text text-darken-2">unfold_more</i>
            </h6>
          </div>
        </div>

        <!-- QUESTION HEADERS -->
        <ul class="question-list">
          {% for answer in answers %}
          <li class="question-preview">
            <!-- QUESTION PREVIEW -->
            <div class="question-preview-div hoverable row collapse question-row {% if answer.applicant_answer is True %}yes-answer {% else %}no-answer{% endif %}">
              <div class="row header-row question-row">
                <div class="col cell-header question-icon-div">
                  <i class="question-icons material-icons {% if answer.applicant_answer is True %}{% if forloop.counter|divisibleby:'2' %}green-text {% else %} green-text text-darken-1 {% endif %}{% else %}{% if forloop.counter|divisibleby:'2' %} red-text {% else %} red-text text-darken-1 {% endif %}{% endif %}">question_answer</i>
                </div>
                {% if answer.parent_question.parent_requirement is not None %}
                <div class="col requirement-abbreviation applicant-summary-card-small list card-panel screendoor-color">
                  {{ answer.parent_question.parent_requirement.abbreviation }}
                </div>
                <data class="question-data-text" value=": {{ answer.short_question_text }} "></data>
                <data class="requirement-text" value=": {{ answer.parent_question.parent_requirement.description }} "></data>
                {% endif %}
                <div class="col {% if answer.qualifier_set.all is not None %}
                            s9 {% elif answer.parent_question.parent_requirement is not None %} s10 {% else %} s11 {% endif %} cell-header question-row short-question-text truncation">{{ answer.parent_question.short_question_text }}
                </div>
                <div class="col right">
                  {% for qualifier in answer.qualifier_set.all %}
                  <div class="tooltip">
                    <i class="material-icons {% if qualifier.status == 'FAIL' %}red-text{% elif qualifier.status == 'PASS' %}green-text{% else %}grey-text{% endif %}">{% if qualifier.status == 'FAIL' %}close{% elif qualifier.status == 'PASS' %}check_circle{% else %}help_outline{% endif %}</i>
                    <span class="tooltiptext">{% if qualifier.status == 'FAIL' %}Failed{% elif qualifier.status == 'PASS' %}Passed{% else %}Indeterminate{% endif %}: {{ qualifier.qualifier_text }}</span>
                  </div>
                  {% endfor %}
                </div>
                <div class="extract-previews col s11">
                  {% for extract in answer.extract_set|dictsort:"extract_sentence_index" %}
                  {% if extract.extract_type == 'WHEN' %}
                  <i class="material-icons red-text text-lighten-1">date_range</i>
                  {% elif extract.extract_type == 'HOW' %}
                  <i class=" material-icons brown-text text-lighten-1">work</i>
                  {% endif %}
                  <span class="extract-preview grey-text text-darken-1">
                    {{ extract.extract_text|capfirst|linebreaksbr }}
                    <br>
                    {% if extract.next_extract_index != extract.extract_sentence_index and not forloop.last %}
                    {% endif %}
                  </span>
                  {% endfor %}
                </div>
              </div>
            </div>
            <div class="question-answer-full row-closed row {% if answer.applicant_answer is True %}yes-answer-light {% else %}no-answer-light{% endif %}">
              <div class="row question-row question-buttons notes-row">
                <div class="col add-note tooltip">
                  <i class="material-icons orange-text">note_add</i>
                  <span class="tooltiptext">Add a note on this answer</span>
                </div>
                <div class="col s10 notes-area">
                  <form method="post" action="{% url 'add-note' %}" class="note-form" name="note-form" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="hidden" name="parent-answer" value="{{ answer.id }}">

                    <div class="note-box">
                      <textarea class="note-input" name="note-input" placeholder="Enter your note here" required></textarea>
                      <span class="save-cancel-note">
                        <i class="material-icons green-text save-note">add_box</i>
                        <i class="material-icons red-text cancel-note">cancel</i>
                      </span>
                    </div>
                  </form>
                  <div class="notes">
                    {% for note in answer.note_set.all %}
                    <div class="note">
                      <form method="post" action="{% url 'delete-note' %}" class="delete-note-form" name="delete-note-form" enctype="multipart/form-data">
                        {% csrf_token %}
                        <input type="hidden" name="parent-answer" value="{{ answer.id }}">
                        <input type="hidden" name="note-id" value="{{ note.id }}">
                        <input type="hidden" class="note-delete-answer-counter" value="{{ forloop.parentloop.counter0 }}">{{ forloop.counter }}.
                        <span class="note-text">{{ note.note_text }}</span>
                        <br>
                        <span class="note-author grey-text">{{ note.author }}, </span><span class="note-created grey-text">{{ note.created }}</span>
                        <i class="material-icons red-text delete-note">delete_forever</i>
                      </form>
                    </div>
                    {% endfor %}
                  </div>
                </div>
              </div>
              <div class="row question-row question-response-extracts">
                <div class="col s7 applicant-response-full"><p class="complementary-response-header">{{ applicantText.complementary_response }}</p><span class="answer-complementary-response">{{ answer.applicant_complementary_response }}</span>
                </div>
                <div class="col s4 extracts-full">
                  <p class="extract-full-header">{{ applicantText.extracts }}</p>
                  <data class="answer-complementary-response-value" value="{{ answer.applicant_complementary_response }}" />
                  <data class="answer-id" value="{{ answer.id }}" />
                  {% for extract in answer.extract_set|dictsort:"extract_sentence_index" %}

                  <!-- Data classes for sentence highlighting -->
                  <data class="extract-string-index" value="{{ extract.extract_sentence_index }}"></data>
                  <data class="extract-ending-index" value="{{ extract.extract_ending_index }}"></data>
                  <data class="extract-next-index" value="{{ extract.next_extract_index }}"></data>
                  <data class="extract-string" value="{{ extract.extract_text }}"></data>
                  <data class="extract-id" value="{{ extract.id }}"></data>
                  <data class="extract-parent-answer-id" value="{{ extract.parent_answer.id }}"></data>
                  <data class="extract-parent-answer" value="{{ extract.parent_answer.applicant_complementary_response }}"></data>
                  <!-- Extracts full -->
                  <span class="extract-full">
                    {% if extract.extract_type == 'WHEN' %}
                    <i class="material-icons red-text text-lighten-1">date_range</i>
                    {% elif extract.extract_type == 'HOW' %}
                    <i class="material-icons brown-text text-lighten-1">work</i>
                    {% endif %}
                    <span class="grey-text text-darken-1">
                      <span class="extract-text">{{ extract.extract_text|capfirst|linebreaksbr }}</span>
                      <br>
                    </span>
                  </span>
                  {% endfor %}
                </div>
              </div>
            </div>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Misc. helper functions -->
<script src="{% static 'js/helper-functions.js' %}"></script>
<!-- Script for expanding and collapsing table rows -->
<!-- <script src="{% static 'js/tables.js' %}"></script> -->
<!-- Script for local storage -->
<script src="{% static 'js/localstorage.js' %}"></script>
<!-- Script for extract origin highlighting -->
<script src="{% static 'js/sentence-highlighting.js' %}"></script>
<!-- Script for initializing modal pop-ups -->
<script src="{% static 'js/sd-modal.js' %}"></script>
<script src="{% static 'js/applicant-questions.js' %}"></script>
<script src="{% static 'js/position.js' %}"></script>
<!-- Script for adding notes to positions -->
<script src="{% static 'js/notes.js' %}"></script>
{% endblock %}
