{% extends 'base_logged_in.html' %}
{% load string_interpolation %}
{% load static %}
{% block content %}

<!-- PLACEHOLDER -->
<div class="container positions">
  <a href="{% url 'position' applicant.parent_position.reference_number applicant.parent_position.id %}" class="btn-flat blue-text sort-positions">←  {{ applicantText.back_to_position }}: {{ applicant.parent_position.position_title }}</a>
  <input type="hidden" class="hidden" name="position-id" value='{{ position.id }}'>
  <h6 class="btn-flat disabled"></h6>
  <form method="post" id="save-position" enctype="multipart/form-data" action="">
    {% csrf_token %}
    <div class="row">
      <!--Beginning of application card -->
      <div class="col card white hoverable">
        <div class="card-content col s12 applicant-card">
          <!-- Application row 1 headers -->
          <!-- Upload Applications and Delete buttons -->
          <div class="applicant-collapse-buttons">
            <input type="button" class="btn-flat right" id="expand-all" value="{{ applicantText.expand_all }}">
            <input type="button" class="btn-flat right" id="collapse-all" value="{{ applicantText.collapse_all }}">
          </div>
          <table class="highlight">
            <!-- Applicant Totals -->
            <thead>
              <tr>
                <th colspan="26"><h6 class="valign-wrapper"><i class="applicant-icon material-icons small {% if percentage_correct <= 33 %}red-text{% elif percentage_correct > 33 and percentage_correct <= 66 %}orange-text{% elif percentage_correct > 66 and percentage_correct <= 100 %}green-text{% endif %} text-darken-2">person</i>{{ applicantText.applicant_information }}<span class="{% if percentage_correct <= 33 %}red-text{% elif percentage_correct > 33 and percentage_correct <= 66 %}orange-text{% elif percentage_correct > 66 and percentage_correct <= 100 %}green-text{% endif %} text-darken-2 applicant-question-total">{{ number_yes_responses}}</span><span class="">/{{ number_questions }} {{ applicantText.questions|lower }} ({% widthratio number_yes_responses number_questions 100 %}%)</span></h6></th>
              </tr>
            </thead>
            <thead class="collapse">
              <tr>
                <th colspan="2"><i class="collapse-arrows material-icons grey-text text-darken-2">keyboard_arrow_down</i></th>
                <th colspan="8">{{ applicantText.applicant_id }}</th>
                <th colspan="7">{{ applicantText.citizenship }}</th>
                <th colspan="9">{{ applicantText.classifications }}</th>
              </tr>
            </thead>
            <!-- Application row 1 body -->
            <tbody>
              <tr>
                <th colspan="2"></th>
                <td colspan="8">{{ applicant.applicant_id }}</td>
                <td colspan="7">{{ applicant.citizenship }}</td>
                <td colspan="9">{% for classification in classifications %}{{ applicantText.substantive }}: {{ classification.classification_substantive }}<br>{{ applicantText.current }}: {{ classification.classification_current }}{% endfor %}</td>
              </tr>
            </tbody>
            <!-- Application row 2 head -->
            <thead class="collapse">
              <tr>
                <th colspan="2"><i class="collapse-arrows material-icons grey-text text-darken-2">keyboard_arrow_down</i></th>
                <th colspan="8">{{ applicantText.priority }}</th>
                <th colspan="7">{{ applicantText.veteran_preference }}</th>
                <th colspan="9">{{ applicantText.streams }}</th>
              </tr>
            </thead>
            <!-- Application row 2 body -->
            <tbody>
              <tr>
                <th colspan="2"></th>
                <td colspan="8">{{ applicant.priority }}</td>
                <td colspan="7">{{ applicant.veteran_preference }}</td>
                <td colspan="9">{% for stream in streams reversed %}{{ stream.stream_name }}{% if forloop.counter < streams|length %} | {% endif %}{% endfor %}</td>
              </tr>
            </tbody>
            <!-- Application row 3 headers -->
            <thead class="collapse">
              <tr>
                <th colspan="2"><i class="collapse-arrows material-icons grey-text text-darken-2">keyboard_arrow_down</i></th>
                <th colspan="8">{{ applicantText.french_working_ability }}</th>
                <th colspan="7">{{ applicantText.english_working_ability }}</th>
                <th colspan="9">{{ applicantText.first_official_language }}</th>
              </tr>
            </thead>
            <!-- Application row 3 body -->
            <tbody>
              <tr>
                <th colspan="2"></th>
                <td colspan="8">{{ applicant.french_working_ability }}</td>
                <td colspan="7">{{ applicant.english_working_ability }}</td>
                <td colspan="9">{{ applicant.first_official_language }}</td>
              </tr>
            </tbody>
            <!-- Application row 4 headers -->
            <thead class="collapse">
              <tr>
                <th colspan="2"><i class="collapse-arrows material-icons grey-text text-darken-2">keyboard_arrow_down</i></th>
                <th colspan="8">{{ applicantText.written_exam_language }}</th>
                <th colspan="7">{{ applicantText.correspondence_language }}</th>
                <th colspan="9">{{ applicantText.interview_language }}</th>
              </tr>
            </thead>
            <!-- Application row 4 body -->
            <tbody>
              <tr>
                <th colspan="2"></th>
                <td colspan="8">{{ applicant.written_exam }}</td>
                <td colspan="7">{{ applicant.correspondence }}</td>
                <td colspan="9">{{ applicant.interview }}</td>
              </tr>
            </tbody>
            <!-- Beginning of Education Section -->
            {% if educations is not None %}
            <thead>
              <tr>
                <th><h6 class="center">{{ applicantText.education }}</h6></th>
              </tr>
            </thead>
            <!-- Education Headers -->
            {% for education in educations %}
            <thead class="collapse blank-answer">
              <tr class="education-header">
                <th colspan="1"><i class="collapse-arrows material-icons grey-text text-darken-2">keyboard_arrow_down</i></th>
                <td colspan="1">{{ forloop.counter }}.</td>
                <!-- Displays academic level full width if no institution and area of study (i.e., for secondary school) -->
                <th id="education-academic-truncated{{ forloop.counter0 }}"
                    class="truncation" colspan="
                        {% if education.institution is None and education.area_of_study is None %}
                        23
                        {% else %}
                        8
                        {% endif %}">{{ education.academic_level }}</th>
                {% if education.institution is not None %}
                <th id="education-institution-truncated{{ forloop.counter0 }}" class="truncation" colspan="7">
                  {{ education.institution }}
                </th>
                {% endif %}
                {% if education.area_of_study is not None %}
                <th id="education-areastudy-truncated{{ forloop.counter0 }}" class="truncation"  colspan="8">
                  {{ education.area_of_study }}
                </th>
                {% endif %}
                <th class="ellipsis education-ellipsis" colspan="1">
                  <i class="material-icons">more_horiz</i>
                </th>
              </tr>
              <!-- Hidden education header revealed when clicked -->
              <tr class="education-header-clicked hide">
                <th colspan="1"><i class="material-icons grey-text text-darken-2">keyboard_arrow_down</i></th>
                <td colspan="1">{{ forloop.counter }}.</td>
                <td colspan="8" class="table-subhead">{{ applicantText.academic_level }}</td>
                <td colspan="7" class="table-subhead">{{ applicantText.institution }}</td>
                <td colspan="9" class="table-subhead">{{ applicantText.area_of_study }}</td>
              </tr>
            </thead>
            <!-- END OF EDUCATION HEADER -->
            <tbody>
              <tr>
                <td colspan="2"></td>
                <td colspan="8">{{ education.academic_level }}</td>
                <td colspan="7">{{ education.institution }}</td>
                <td colspan="9">{{ education.area_of_study }}</td>
              </tr>
            </tbody>
            <tbody>
              <tr>
                <td colspan="2"></td>
                <td colspan="5" class="table-subhead">{{ applicantText.specialization }}</td>
                <td colspan="5" class="table-subhead">{{ applicantText.program_length }}</td>
                <td colspan="5" class="table-subhead">{{ applicantText.years_completed }}</td>
                <td colspan="9" class="table-subhead">{{ applicantText.graduation_date }}</td>
              </tr>
            </tbody>
            <tbody>
              <tr>
                <td colspan="2"></td>
                <td colspan="5">{{ education.specialization }}</td>
                <td colspan="5">{{ education.program_length }}</td>
                <td colspan="5">{{ education.num_years_completed }}</td>
                <td colspan="9">{{ education.graduation_date }}</td>
              </tr>
            </tbody>
            {% endfor %}
            <!-- END OF EDUCATION DATA -->
            {% endif %}
            <thead>
              <tr>
                <th><h6 class="center">{{ applicantText.questions }}</h6></th>
              </tr>
            </thead>
            {% for answer in answers %}
            <input type="hidden" id="analysis-full{{ forloop.counter0 }}" value="{{ answer.analysis|capfirst|analysis_linebreaks|linebreaks }}">
            <input type="hidden" id="analysis-short{{ forloop.counter0 }}" value="• {{ answer.analysis|capfirst|display_first_line }}">
            <!-- Question -->

            <!-- BEGINNING OF QUESTION/ANALYSIS PREVIEWS -->

            <!-- Displays green/red for Yes/No -->
            <thead class="collapse question-header
                          {% if answer.applicant_answer == True %}yes-answer
                          {% else %}no-answer{% endif %}">
              <tr id="previews-small{{ forloop.counter0 }}">
                <th colspan="1">
                  <i class="collapse-arrows material-icons grey-text text-darken-2">keyboard_arrow_down</i>
                </th>
                <td colspan="1">{{ forloop.counter }}.</td>
                <!-- Displays question full width if there is no accompanying analysis, e.g. if the respondent answered "no" -->
                <th id="truncated{{ forloop.counter0 }}" class="truncation" colspan="
                        {% if answer.analysis is not None %}10
                        {% else %}23{% endif %}">
                  <div class="question-subhead hide">Question</div>
                  <span class="question-preview">{{ answer.parent_question.short_question_text|strip_all_asterix }}</span>
                </th>
                {% if answer.analysis is not None %}
                <th colspan="1"></th>
                <th id="truncated-analysis{{ forloop.counter0 }}" class="truncation" colspan="12">
                  <div id="analysis-subhead{{ forloop.counter0 }}" class="analysis-subhead hide">Analysis</div>
                  <span class="analysis-preview blue-text text-darken-2">• {{ answer.analysis|display_first_line|capfirst }}</span>
                </th>
                {% else %}
                <th colspan="1" class="hide"></th>
                <th id="truncated-analysis{{ forloop.counter0 }}" class="hide truncation" colspan="12">
                  <div id="analysis-subhead{{ forloop.counter0 }}" class="hide analysis-subhead hide">Analysis</div>
                  <span class="hide analysis-preview blue-text text-darken-2">{{ answer.analysis }}</span>
                </th>
                {% endif %}
                <th colspan="1">
                  <span class="ellipsis question-ellipsis">
                    <i class="material-icons">more_horiz</i>
                  </span>
                </th>
              </tr>
              <!-- Beginning of hidden full analysis preview -->
              <tr class="question-full-header" id="previews-full{{ forloop.counter0 }}">
                <td colspan="2"></td>
                <td colspan="{% if answer.analysis is not None %}10
                             {% else %}23{% endif %}">
                  <span class="question-full">{{ answer.parent_question.short_question_text|strip_all_asterix }}</span>
                </td>
                {% if answer.analysis is not None %}
                <td colspan="1"></td>
                <td colspan="12">
                  <span class="analysis-full blue-text text-darken-2">{% if answer.analysis is not None %}
                    {{ answer.analysis|capfirst|analysis_linebreaks|linebreaks }}{% endif %}</span>
                </td>
                {% else %}
                <th colspan="1" class="hide"></th>
                <th class="hide" colspan="12"></th>
                {% endif %}
                <td colspan="1"></td>
              </tr>
              <!-- End of hidden full analysis preview -->
              <!-- Hidden full clicked question/answer contents header -->
              <tr class="clicked-question-header" id="clicked-header{{ forloop.counter0 }}">
                <th colspan="1">
                  <i class="material-icons grey-text text-darken-2">keyboard_arrow_down</i>
                </th>
                <td colspan="1">{{ forloop.counter }}.</td>
                <td class="table-subhead" colspan="9">{{ applicantText.question }}</td>
                <th colspan="1"></th>
                <td class="table-subhead" colspan="3">{{ applicantText.response }}</td>
                <td class="table-subhead" colspan="10">{% if answer.applicant_answer is True and answer.applicant_complementary_response is not None %}{{ applicantText.complementary_question }}{% endif %}</td>
                <th colspan="1"></th>
              </tr>
            </thead>

            <!-- END OF QUESTION/ANALYSIS PREVIEWS -->

            <!-- Displays red or green if answer is yes or no -->
            <tbody class="{% if answer.applicant_answer == True %}yes-answer-light{% else %}no-answer-light{% endif %}">
              <tr>
                <td colspan="2"></td>
                <td colspan="9">{{ answer.parent_question.question_text|fix_single_asterix|fix_double_asterix|linebreaks }}</td>
                <td colspan="1"></td>
                <td colspan="3">{% if answer.applicant_answer is True %}{{ applicantText.yes }}{% else %}{{ applicantText.no }}{% endif %}</td>
                <td colspan="10">{% if answer.applicant_answer is True and answer.applicant_complementary_response is not None %}{{ answer.parent_question.complementary_question_text }}{% else %}{% endif %}</td>
                <td colspan="1"></td>
              </tr>
            </tbody>
            {% if answer.applicant_answer is True and answer.applicant_complementary_response is not None %}
            <tbody class="{% if answer.applicant_answer == True %}yes-answer-light{% else %}no-answer-light{% endif %}">
              <tr>
                <td colspan="2"></td>
                <td colspan="12" class="table-subhead">{{ applicantText.complementary_response }}</td>
                <td colspan="1"></td>
                <td colspan="10" class="table-subhead">{{ applicantText.analysis }}</td>
                <td colspan="1"></td>
              </tr>
            </tbody>
            <tbody class="{% if answer.applicant_answer == True %}yes-answer-light{% else %}no-answer-light{% endif %}">
              <tr>
                <td colspan="2"></td>
                <td colspan="12">{{ answer.applicant_complementary_response }}</td>
                <td colspan="1"></td>
                <td colspan="10" class="blue-text text-darken-2">{{ answer.analysis|capfirst|analysis_linebreaks|linebreaks }}</td>
                <td colspan="1"></td>
              </tr>
            </tbody>
            {% endif %}
            {% endfor %}
          </table>
          <!-- Date and time position was added -->
          <!-- <div class="row position-bottom-buttons">
               <h6 class="btn-flat right black-text">Application added: 2019-06-12</h6>
               </div> -->
        </div>
      </div>
    </div>
  </form>
  <!-- MaterializeCSS JS library  -->
  <script src="{% static 'js/materialize.js' %}"></script>
  <!-- Script for expanding and collapsing table rows -->
  <script src="{% static 'js/tables-applicant.js' %}"></script>
  <!-- Inline JS for using Django variables -->
  <script>

  </script>
  {% endblock %}
